<!-- Login EJS template -->

<html>
<head>
    <%- include('partials/head.ejs',
    {
    pageTitle: 'Home',
    pageDescription: 'Dashboard for mcdns.me',
    }) %>
</head>
<body class="bg-gray-100 text-gray-900">
<div class="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full">
        <% for (let i = 0; i < servers.length; i++) { %>
            <!-- Each server will have a list item entry, that when clicked, will redirect to the server's dashboard -->
            <div class="mt-0">
                <a href="/dashboard/<%= servers[i].id %>"
                   class="flex items-center justify-between bg-white <% if (i == 0) { %> rounded-t-lg <% } %> border border-gray-300 p-4">
                    <div class="flex items-center justify-between">
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">
                                <%= servers[i].name %>
                            </div>
                            <div class="text-sm text-gray-500" id="server-<%= servers[i].id %>-status">
                                <!-- Server online status (will be updated by websocket) -->
                                Loading...
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        <% } %>
        <!-- Create server -->
        <div class="mt-0">
            <a href="/create"
               class="flex items-center justify-between bg-white rounded-b-lg border border-gray-300 p-4">
                Create Server
            </a>
        </div>
    </div>
</div>

<!-- Websocket script -->
<script src="/socket.io/socket.io.js"></script>
<script>
	// connect to socket
	var socket = io();

	socket.on('connect', function () {
        socket.emit("declare", "index")
		// emit the server id to the server
		socket.on('status', function (data) {
			// update the status of the server
			if (data.online === true) {
				// Inner HTML will be a green circle (use tailwind css to make this!) and the text "Online"
                let html = `
                    <svg class="h-4 w-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 12a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm0 2a10 10 0 100-20 10 10 0 000 20z" clip-rule="evenodd"></path>
                    </svg>
                    Online
                `
                document.getElementById("server-" + data.id + "-status").innerHTML = html;
			} else {
				// Inner HTML will be a red circle (use tailwind css to make this!) and the text "Offline"
                let html = `
                    <svg class="h-4 w-4 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 12a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm0 2a10 10 0 100-20 10 10 0 000 20z" clip-rule="evenodd"></path>
                    </svg>
                    Offline
                `
                document.getElementById("server-" + data.id + "-status").innerHTML = html;
			}
		});
	});
</script>
</body>
</html>
